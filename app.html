<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CCTV Stream Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: auto; padding: 20px; background: #f5f5f5; }
    .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    h1 { color: #333; }
    input[type="text"] { width: 100%; padding: 8px; margin: 8px 0; border: 1px solid #ccc; border-radius: 4px; }
    button { padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
    #start-btn { background: #4CAF50; color: white; }
    #stop-btn { background: #f44336; color: white; }
    #video-container { margin-top: 20px; text-align: center; }
    #video-feed { max-width: 100%; border: 1px solid #ddd; background: #000; }
    #status { margin-top: 10px; padding: 10px; border-radius: 4px; }
    .success { background: #dff0d8; color: #3c763d; }
    .error { background: #f2dede; color: #a94442; }
  </style>
</head>
<body>
  <div class="container">
    <h1>CCTV Stream Viewer</h1>

    <input type="text" id="stream-url" placeholder="Enter RTSP or HTTP stream URL">
    <p><small>Example: rtsp://user:pass@camera_ip:554/stream1</small></p>

    <button id="start-btn">Start Stream</button>
    <button id="stop-btn">Stop Stream</button>

    <div id="status"></div>

    <div id="video-container">
      <img id="video-feed" src="">
    </div>
  </div>

  <script>
    const startBtn = document.getElementById("start-btn");
    const stopBtn = document.getElementById("stop-btn");
    const videoFeed = document.getElementById("video-feed");
    const statusDiv = document.getElementById("status");

    function updateStatus(msg, error=false) {
      statusDiv.textContent = msg;
      statusDiv.className = error ? "error" : "success";
    }

    startBtn.onclick = () => {
      const streamUrl = document.getElementById("stream-url").value.trim();
      if (!streamUrl) { updateStatus("Please enter a stream URL", true); return; }

      fetch("/start_stream", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: "stream_url=" + encodeURIComponent(streamUrl)
      })
      .then(r => r.json())
      .then(d => {
        if (d.success) {
          updateStatus("Stream started");
          videoFeed.src = "/video_feed?" + new Date().getTime();
        } else updateStatus("Error: " + d.message, true);
      })
      .catch(e => updateStatus("Error: " + e, true));
    };

    stopBtn.onclick = () => {
      fetch("/stop_stream", { method: "POST" })
      .then(r => r.json())
      .then(d => {
        if (d.success) {
          updateStatus("Stream stopped");
          videoFeed.src = "";
        } else updateStatus("Error stopping stream", true);
      })
      .catch(e => updateStatus("Error: " + e, true));
    };
  </script>
</body>
</html>
